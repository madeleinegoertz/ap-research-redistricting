# AP Research Redistricting Project

This repository contains all of my work for my AP Research project that compared the performance of two different automated redistricting algorithms, [Markov Chain Monte Carlo and Sequential Monte Carlo](https://github.com/kosukeimai/redist), in a hypothetical redistricting scenario of the Virginia Congressional Districts for the 2020s.

View the project dashboard [here](https://www.notion.so/AP-Research-Redistricting-Project-e065fd900cd747e4b692e51b6a6584b3).

I used Python 3 to aggregate the shapefile data, R to run the redistricting algorithms, Python again to generate data tables, and LaTeX to typeset my paper.

## Data

The [data](https://github.com/madeleinegoertz/ap-research-redistricting/tree/master/data) directory contains the data for this project.

* `va_2018_ushouse_precincts.zip` contains a shapefile of precinct-level election results for the 2019 state-wide elections in Virginia. These were sourced from the [Voting and Election Science Team on the Harvard Dataverse](https://dataverse.harvard.edu/file.xhtml?persistentId=doi:10.7910/DVN/UBKYRU/K8EV6K&version=34.0).
  
* `va_acs_2018_blockgroup.zip` contains a shapefile of block-group-level population data for Virginia. This data came from the American Community Survey 2014-2018 5-year-estimates, downloaded from [IPUMS](https://www.nhgis.org/).

* `va_ushouse_2018_precincts_data.zip` is generated by running `01_shp_prep.py`, which aggregates the block-group level population data up to the precinct level. *This aggregation relies on the [maup](https://github.com/mggg/maup) package for Python.*

I used 2018 data because 2020 redistricting data was not publicly available at the time of the project in early 2021.

## Setup

Running `01_data_prep.R` generates `data.RData`, which holds the shapefile data as well as other helpful prerequisites for redistricting.

## Running Redistricting Algorithms

I compare two different redistricting algorithms, MCMC and SMC, both of which are implemented by the [redist](https://github.com/kosukeimai/redist) R package.

1. `10_crsg.R` runs the CRSG algorithm, which is a prerequisite to MCMC. Output stored in `crsg.RData`.
2. `11_mcmc.R` runs 100 simulations of the MCMC algorithm. Output stored in `mcmc.RData`.
3. `12_smc.R` runs 100 simulations of the SMC algorithm. Output stored in `smc.RData`.

## Evaluating Redistricting Plans

These generated redistricting plans can now be evaluated against the existing plans by computing various compactness and partisan fairness measures.

### Compactness Measures

1. `20_compact_raw.R` computes compactness measures for the MCMC, SMC, and existing districts. Output stored in `compact.raw.RData`.
2. `21_compact_calc.R` takes the raw compactness measures and aggregates them to each simulation. Output store in `compact.csv`.

### Partisan Fairness Measures

1. `30_fair_raw.R` computes partisan fairness measures for the MCMC, SMC, and existing districts. Output stored in `fair.raw.RData`.
2. `31_fair_calc.R` takes the raw fairness measures and aggregates them to each simulation. Output stored in `fair.csv`.

## Generate Tables & Figures

* `40_fig_table.py` takes `compact.csv` and `fair.csv` and generates a proper data table in LaTeX. Output written to `paper/results/tbl.tex`.

* `41_fig_maps.R` takes the raw compactness measures and redistricting output and plots the most compact districts based on Polsby-Popper and Edge-Cut Compactness score. Plots written to `paper/img/maps.<alg>.<measure>.png`. Subfigures put together in `paper/results/maps.tex`.

* `42_fig_seatsvotes.R` takes the raw fairness measures and computes seats-votes curves for each proposal. Plots must be manually exported in RStudio. Subfigures put together in `paper/results/seatsvotes.tex`.*Generating the seats-votes curves relies on my modified version of the [pscl](https://github.com/madeleinegoertz/pscl/) package for R, which can be installed via `install_github(madeleinegoertz/pscl)` from the `devtools` package.

* `43_fig_election.R` takes the raw and computed fairness measures and the redistricting output and plots the results of the 2018 election under said redistricting plan. Plots written to `paper/img/elec.<alg>.png`. Subfigures put together in `paper/results/election_maps.tex`.

## Paper

The paper is typeset using LaTeX, which can be accomplished by building `paper/paper.tex`. The final pdf of the paper is located at `paper/paper.pdf`.
