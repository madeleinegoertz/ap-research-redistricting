# This script calculates compactness measures for the plans generated by
# all the algorithm and the existing plan.

library(redist)
library(tidyverse)
load("results/data.RData")
load("results/mcmc.RData")
load("results/smc.RData")
load("results/crsg.RData")

# MCMC
mcmc.compact <-
  redist.compactness(
    shp = df,
    district_membership = mcmc.out$partitions,
    measure = c("PolsbyPopper", "FryerHolden", "EdgesRemoved"),
    population = df$pop, 
    adjacency = adjlist,
    counties = df$COUNTYFP,
    ncores = 4
  )

# SMC
smc.compact <-
  redist.compactness(
    shp = df,
    district_membership = smc.out$cdvec,
    measure = c("PolsbyPopper", "FryerHolden", "EdgesRemoved"),
    population = df$pop, 
    adjacency = adjlist,
    counties = df$COUNTYFP,
    ncores = 4
  )

# CRSG
crsg.compact <-
  redist.compactness(
    shp = df,
    district_membership = crsg.out$partitions,
    measure = c("PolsbyPopper", "FryerHolden", "EdgesRemoved"),
    population = df$pop, 
    adjacency = adjlist,
    counties = df$COUNTYFP,
    ncores = 4
  )

# Control
control.compact <-
  redist.compactness(
    shp = df,
    district_membership = df$CON_DIST,
    measure = c("PolsbyPopper", "FryerHolden", "EdgesRemoved"),
    population = df$pop, 
    adjacency = adjlist,
    counties = df$COUNTYFP,
    ncores = 4
  )

raw.compact <-
  list(
    mcmc = mcmc.compact,
    smc = smc.compact,
    crsg = crsg.compact,
    control = control.compact
  )

save(raw.compact, file = "results/raw.compact.RData")
