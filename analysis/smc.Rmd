---
title: "SMC Plots"
output: html_notebook
---

```{r}
library(tidyverse)
library(sf)
library(redist)
library(sp)
library(spData)
library(spdep)
```

```{r}
df <- st_read("C:/Users/madie/OneDrive/data/pre-redist/VA_precinct_2018/VA_precinct_2018.shp")
```
```{r}
precinct$CON_DIST <- as.numeric(precinct$CON_DIST)
adjlist <- spdep::poly2nb(precinct, queen = FALSE)
centroid <- st_centroid(precinct$geometry)
distancemat <- st_distance(centroid, centroid)
# replace NA populations with 0
precinct$pop[is.na(precinct$pop)] <- 0
```

```{r}
# try to redistrict using smc!
start.time <- Sys.time()
smc.out <- redist.smc(
  adjobj = adjlist,
  popvec = precinct$pop,
  ndists = 11,
  nsims = 1000,
  popcons = 0.1
)
end.time <- Sys.time()
save(smc.out, file = "C:/Users/madie/ap-research-redistricting/analysis/mcmc_vac_2018_smc_rstudio.RData")
print(end.time - start.time)
```

```{r}
# optimal color palette 
colors <- c("#DA618D", "#85D7D4", "#044b62", "#D5D160", "#e7854b", "#6cc32f", "#A87ADA", "#DAB8D3", "#C843DB", "#329349", "#78A5D5")
# add row_n as unique precinct identifier to join on
precinct$row_n <- seq.int(nrow(precinct))


precinct %>%        
  ggplot(aes(fill = factor(smc.out$cdvec[,1]))) +
    geom_sf(size = 0, color = NA) +
    scale_color_manual(values = colors) +
    coord_sf(datum = NA) +
    theme_void() + 
    labs(
        title = "Hypothetical districts - SMC",
        fill = "Assignment\nprobability"
    )
```
```{r}
smc.out$cdvec
```

